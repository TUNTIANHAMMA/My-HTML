<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>留言板</title>
    <link rel="stylesheet" href="../css/dashboad.css" />
</head>

<body background="../img/1367104084.gif" bgcolor="#000000" onload="blink();">
    <iframe id="player" frameborder="0" allowfullscreen
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin" title="Treow / NaturaLe / ARUKO - selFa" width="0" height="0"
        src="https://www.youtube.com/embed/MFcpcwdBYrk?mute=0&autoplay=1&enablejsap…etid=1&forigin=https%3A%2F%2Ffauux.neocities.org%2Fnoise&aoriginsup=1&vf=1"
        __idm_id__="3637249"></iframe>
    <img src="../img/noise.gif" id="noise" alt="点我" />
    <img src="../img/whoo.jpg" id="floatingImg" alt="点我" />
    <div class="container">
        <h1>Hahahahah,you cant escape,</h1>
        <form id="messageForm">
            <input type="text" id="username" placeholder="What's your name?" required />
            <textarea id="message" placeholder="Stay in this wired world...Stay with me." required></textarea>
            <button type="submit">Stay in this wired world...Stay with me.</button>
        </form>
        <ul id="messageList"></ul>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function () {
            function loadMessages() {
                const messages = JSON.parse(localStorage.getItem("messages") || "[]");
                $("#messageList").empty();

                messages.forEach((msg, index) => {
                    const item = $(`
        <li class="message-item">
          <strong>${escapeHtml(msg.username)}</strong> said：<br/>
          ${escapeHtml(msg.content)}
          <span>${msg.time}</span>
          <span class="delete" data-index="${index}">🗑 删除</span>
        </li>
      `);
                    $("#messageList").append(item);
                });
            }

            function escapeHtml(text) {
                return text.replace(/[<>"&]/g, (match) => {
                    const map = {
                        "<": "&lt;",
                        ">": "&gt;",
                        '"': "&quot;",
                        "&": "&amp;",
                    };
                    return map[match];
                });
            }

            $("#messageForm").submit(function (e) {
                e.preventDefault();

                const username = $("#username").val().trim();
                const content = $("#message").val().trim();
                if (!username || !content) return;

                const newMessage = {
                    username,
                    content,
                    time: new Date().toLocaleString(),
                };

                const messages = JSON.parse(localStorage.getItem("messages") || "[]");
                messages.unshift(newMessage); // 添加到最前面
                localStorage.setItem("messages", JSON.stringify(messages));

                $("#username").val("");
                $("#message").val("");
                loadMessages();
            });

            $("#messageList").on("click", ".delete", function () {
                const index = $(this).data("index");
                const messages = JSON.parse(localStorage.getItem("messages") || "[]");
                messages.splice(index, 1);
                localStorage.setItem("messages", JSON.stringify(messages));
                loadMessages();
            });

            loadMessages(); // 页面加载时初始化留言
        });




        let clickCount = 0;

        $("#floatingImg").on("click", function () {
            clickCount++;

            if (clickCount >= 3) {
                window.location.href = "../html/ShowPage.html"; // 点击三次后跳转
            }
        });

        let moveTimer = null;
        let hasMoved = false;

        function moveImageRandomly() {
            const maxX = $(window).width() - 60;
            const maxY = $(window).height() - 60;
            const randX = Math.random() * maxX;
            const randY = Math.random() * maxY;

            const img = $("#floatingImg");

            // 闪烁：先隐藏，再移动，再显示
            img.css("opacity", "0");
            setTimeout(() => {
                img.css({
                    top: randY + "px",
                    left: randY + "px",
                    opacity: "1"
                });
            }, 200);
        }

        $(document).on("mousemove", function () {
            if (hasMoved) return;

            hasMoved = true;
            clearTimeout(moveTimer);

            moveTimer = setTimeout(() => {
                moveImageRandomly();
                hasMoved = false;
            }, 500);
        });

    </script>
</body>

</html>